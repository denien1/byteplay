<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BytePlay — Instant classics, in your browser</title>
  <meta name="description" content="Play SNES, GBA, and Atari 2600 games instantly in your browser with BytePlay. Save states live locally.">
  <link rel="icon" href="assets/favicon.svg">
  <link rel="preload" href="assets/Nintendo.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <!-- background particles, always behind -->
  <div id="particles-js"></div>

  <div class="container">
    <header class="header">
      <a class="brand" href="./" title="Return Home">
        <img src="assets/logo.svg" alt="BytePlay"/>
        <div class="brand-text">
          <b class="title-font">BytePlay</b>
          <small>Instant classics, in your browser.</small>
        </div>
      </a>
      <nav class="nav">
        <a class="btn ghost" href="about.html">About</a>
        <a class="btn ghost" href="contact.html">Contact</a>
        <a class="btn primary" href="./">Browse all Games</a>
        <a class="btn ghost" href="play.html?id=byor">Upload ROM</a>
      </nav>
    </header>

    <!-- centered hero with Wave title -->
    <section class="hero hero-center">
      <h1 class="wave-text title-font" aria-label="BytePlay">
        <span>B</span><span>y</span><span>t</span><span>e</span><span>P</span><span>l</span><span>a</span><span>y</span>
      </h1>
      <h2 class="subtitle-lg">Pick a classic. Press start.</h2>
      <p class="subtitle-md">Click a cover to start playing immediately. Save states and settings live in your browser.</p>
    </section>

    <!-- filters -->
    <div class="search">
      <input id="q" placeholder="Search title or genre…">
      <select id="system">
        <option value="">All systems</option>
        <option value="gba">GBA</option>
        <option value="snes">SNES</option>
        <option value="atari2600">Atari 2600</option>
      </select>
      <select id="year">
        <option value="">All years</option>
        <option>1982</option><option>1990</option><option>1991</option><option>1993</option><option>1994</option>
        <option>1998</option><option>2014</option><option>2018</option><option>2020</option>
      </select>
      <button id="reset" class="btn">Reset</button>
    </div>

    <div id="count" class="meta"></div>
    <div id="grid" class="grid"></div>
    <div class="pager">
      <button class="btn" id="prev">Prev</button>
      <span id="pageLabel" class="meta"></span>
      <button class="btn" id="next">Next</button>
    </div>

    <footer>© <a class="link" href="./">BytePlay</a></footer>
  </div>

  <script>
    const PAGE=12;
    let all=[],filtered=[],page=1;

    async function load(){
      try{
        const r=await fetch('games.json',{cache:'no-store'});
        const data=await r.json();
        // hard filter: ONLY gba/snes/atari2600
        all=(data.games||[]).filter(g=>['gba','snes','atari2600'].includes(g.system));
        filtered=[...all];
        render(); wire();
      }catch(e){
        console.error(e);
        document.getElementById('grid').innerHTML='<div class="err">Failed to load games.json</div>';
      }
    }
    function apply(){
      const q=(document.getElementById('q').value||'').toLowerCase().trim();
      const sys=document.getElementById('system').value;
      const yr=document.getElementById('year').value;
      filtered=all.filter(g=>{
        const t=(g.title+' '+(g.genre||'')+' '+(g.system||'')).toLowerCase();
        if(q && !t.includes(q)) return false;
        if(sys && g.system!==sys) return false;
        if(yr && String(g.year)!==yr) return false;
        return true;
      });
      page=1; render();
    }
    function render(){
      const grid=document.getElementById('grid');
      const count=document.getElementById('count');
      const total=filtered.length;
      const start=(page-1)*PAGE;
      const slice=filtered.slice(start,start+PAGE);

      count.textContent=`${total} game${total!==1?'s':''} found`;

      // direct-to-play like gbapokemon
      grid.innerHTML=slice.map(g=>`
        <a class="card" href="play.html?id=${g.id}" title="Play ${g.title}">
          <img class="cover" src="${g.cover}" alt="${g.title}">
          <div class="content">
            <div class="title title-font">${g.title}</div>
            <div class="meta">${(g.system||'').toUpperCase()} • ${g.year||''} ${g.genre?('• '+g.genre):''}</div>
          </div>
        </a>
      `).join('');

      const pageLabel=document.getElementById('pageLabel');
      pageLabel.textContent=total===0?'0/0':`${Math.min(start+1,total)}-${Math.min(start+slice.length,total)} of ${total}`;

      document.getElementById('prev').disabled=page<=1;
      document.getElementById('next').disabled=(start+PAGE)>=total;
    }
    function wire(){
      document.getElementById('q').oninput=apply;
      document.getElementById('system').onchange=apply;
      document.getElementById('year').onchange=apply;
      document.getElementById('reset').onclick=()=>{
        document.getElementById('q').value='';
        document.getElementById('system').value='';
        document.getElementById('year').value='';
        filtered=[...all]; page=1; render();
      };
      document.getElementById('prev').onclick=()=>{ if(page>1){ page--; render(); } };
      document.getElementById('next').onclick=()=>{ if((page*PAGE)<filtered.length){ page++; render(); } };
    }
    load();
  </script>

  <script src="assets/particles.min.js"></script>
  <script>
    particlesJS.load('particles-js','assets/particles.json',()=>{});
  </script>
</body>
</html>
